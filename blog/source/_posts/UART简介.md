---
title: UART简介
date: 2017-10-14 22:09:21
tags:
---


## 1. 定义 



**UART**（Universal Asynchronous Receiver/Transmitter)，即通用异步收发传输器，是一种异步收发传输器。

具体实物表现为独立的模块化芯片，或作为集成于微处理器中的周边设备。一般是RS-232C规格的，与类似Maxim的MAX232之类的标准信号幅度变换芯片进行搭配，作为连接外部设备的接口。
<!-- more -->

在UART上追加同步方式的序列信号变换电路的产品，被称为**USART**(Universal Synchronous Asynchronous Receiver Transmitter)。

UART总线双向通信，可以实现全双工传输和接收。在嵌入式设计中，UART用于**主机与辅助设备通信**，如汽车音响与外接AP之间的通信，与PC机通信包括与监控调试器和其它器件，如EEPROM通信。


## 2. 通信协议

UART作为异步串口通信协议的一种，工作原理是将传输数据的每个字符一位接一位地传输。
其中各位的意义如下：

**起始位：**先发出一个逻辑”0”的信号，表示传输字符的开始。

**资料位：**紧接着起始位之后。资料位的个数可以是4、5、6、7、8等，构成一个字符。通常采用ASCII码。**从最低位开始传送**，靠时钟定位。

**奇偶校验位：**资料位加上这一位后，使得“1”的位数应为偶数(偶校验)或奇数(奇校验)，以此来校验资料传送的正确性。

**停止位：**它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。 由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。

**空闲位：**处于逻辑“1”状态，表示当前线路上没有资料传送。

**波特率：**是衡量资料传送速率的指标。表示每秒钟传送的符号数（symbol）。一个符号代表的信息量（比特数）与符号的阶数有关。例如资料传送速率为120字符/秒，传输使用256阶符号，每个符号代表8bit，则波特率就是120baud，比特率是120*8=960bit/s。这两者的概念很容易搞错。

## 4. 基本结构


⑴ . **输出缓冲寄存器**，它接收CPU从数据总线上送来的并行数据，并加以保存。

⑵ . **输出移位寄存器**，它接收从输出缓冲器送来的并行数据，以发送时钟的速率把数据逐位移出，即将并行数据转换为串行数据输出。

⑶.  **输入移位寄存器**，它以接收时钟的速率把出现在串行数据输入线上的数据逐位移入，当数据装满后，并行送往输入缓冲寄存器，即将串行数据转换成并行数据。

⑷ . **输入缓冲寄存器**，它从输入移位寄存器中接收并行数据，然后由CPU取走。

⑸. **控制寄存器**，它接收CPU送来的控制字，由控制字的内容，决定通信时的传输方式以及数据格式等。例如采用异步方式还是同步方式，数据字符的位数，有无奇偶校验，是奇校验还是偶校验，停止位的位数等参数。

⑹. **状态寄存器**。状态寄存器中存放着接口的各种状态信息，例如输出缓冲区是否空，输入字符是否准备好等。在通信过程中，当符合某种状态时，接口中的状态检测逻辑将状态寄存器的相应位置“1”，以便让CPU查询。


## 5.设计思想

**发送：**
数据发送的思想是，当启动字节发送时，通过TxD**先发起始位**，然后发**数据位**和**奇偶数校验位**，**最后再发停止位**，发送过程由发送状态机控制，**每次中断只发送1个位**，经过若干个定时中断完成1个字节帧的发送。

**接收：**
数据接收的思想是，当不在字节帧接收过程时，每次定时中断以**3倍的波特率监视RxD的状态**，当其连续3次采样电平依次为**1、0、0时**，就认为检测到了起始位，则开始启动一次字节帧接收，字节帧接收过程由接收状态机控制，**每次中断只接收1个位**，经过若干个定时中断完成1个字节帧的接收。

为了提高串口的性能，在发送和接收上都实现了**FIFO**功能，提高通信的实时性。FIFO的长度可以进行自由定义，适应用户的不同需要。

波特率的计算按照计算公式进行，在设置最高波特率时一定要考虑模拟串口程序代码的执行时间，该定时时间必须大于模拟串口的程序的规定时间。**单片机的执行速度越快，则可以实现更高的串口通讯速度。**


## 6. 工作原理

**a. 波特率产生**

波特率除数（baud-rate divisor）是一个22 位数，它由16 位整数和6 位小数组成。波特率发生器使用这两个值组成的数字来决定位周期。通过带有小数波特率的除法器，在足够高的系统时钟速率下，UART 可以产生所有标准的波特率，而误差很小。

**b. 数据收发**

发送逻辑对从发送FIFO 读取的数据执行“并→串”转换。控制逻辑输出起始位在先的串行位流，并且根据控制寄存器中已编程的配置，后面紧跟着数据位（注意：最低位 LSB 先输出）、奇偶校验位和停止位。

在检测到一个有效的起始脉冲后，接收逻辑对接收到的位流执行“串→并”转换。此外还会对溢出错误、奇偶校验错误、帧错误和线中止（line-break）错误进行检测，并将检测到的状态附加到被写入接收FIFO 的数据中。

发送时，数据被写入发送FIFO。如果UART 被使能，则会按照预先设置好的参数（波特率、数据位、停止位、校验位等）开始发送数据，一直到发送FIFO 中没有数据。一旦向发送FIFO 写数据（如果FIFO 未空），UART 的忙标志位BUSY 就有效，并且在发送数据期间一直保持有效。BUSY 位仅在发送FIFO 为空，且已从移位寄存器发送最后一个字符，包括停止位时才变无效。即 UART 不再使能，它也可以指示忙状态。

在UART 接收器空闲时，如果数据输入变成“低电平”，即接收到了起始位，则接收计数器开始运行，并且数据在Baud16 的第8 个周期被采样。如果Rx 在Baud16 的第8 周期仍然为低电平，则起始位有效，否则会被认为是错误的起始位并将其忽略。

如果起始位有效，则根据数据字符被编程的长度，在 Baud16 的每第 16 个周期（即一个位周期之后）对连续的数据位进行采样。如果奇偶校验模式使能，则还会检测奇偶校验位。
最后，如果Rx 为高电平，则有效的停止位被确认，否则发生帧错误。当接收到一个完整的字符时，将数据存放在接收FIFO 中。


## 7. 通信速率

数据传输可以首先从最低有效位(LSB)开始。然而，有些UART允许灵活选择先发送最低有效位或最高有效位(MSB)。

微控制器中的UART传送数据的速度范围为每秒几百位到1.5Mb。例如，嵌入在ElanSC520微控制器中的高速UART通信的速度可以高达1.152Mbps。UART波特率还受发送和接收线对距离(线长度)的影响。

市场上有只支持异步通信和同时支持异步与同步通信的两种硬件可用于UART。前者就是UART名字本身的含义，在摩托罗拉微控制器中被称为串行通信接口(SCI)；Microchip微控制器中的通用同步异步收发器(USART)和在富士通微控制器中的UART是后者的两个典型例子。

## 8. 应用


![这里写图片描述](http://img.blog.csdn.net/20171012222310544?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzA1MjY1NA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
cr-uart8 8路串口分配器

计算机
UART是计算机中串行通信端口的关键部分。在计算机中，UART相连于产生兼容RS232规范信号的电路。

RS232标准定义逻辑“1”信号相对于地为-3到-15伏，而逻辑“0”相对于地为+3到+15伏。所以，当一个微控制器中的UART相连于PC时，它需要一个RS232驱动器来转换电平。

Uart这里指的是TTL电平的串口；RS232指的是RS232电平的串口。

**TTL电平是5V的，而RS232是负逻辑电平，它定义+5~+12V为低电平，而-12~-5V为高电平。**

Uart串口的RXD、TXD等一般直接与处理器芯片的引脚相连，而RS232串口的RXD、TXD等一般需要经过电平转换(通常由Max232等芯片进行电平转换)才能接到处理器芯片的引脚上，否则这么高的电压很可能会把芯片烧坏。

我们平时所用的电脑的串口就是RS232的，当我们在做电路工作时，应该注意下外设的串口是Uart类型的还是RS232类型的，如果不匹配，应当找个转换线(通常这根转换线内有块类似于Max232的芯片做电平转换工作的)，不能盲目地将两串口相连。
